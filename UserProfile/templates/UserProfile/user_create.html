<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create User</title>
</head>
<body>
    <h1>Create User Account</h1>

    <!-- Display success or error messages -->
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}  <!-- Dynamically render all form fields -->
        <button type="submit" id="create-user-button" {% if form_has_errors %}disabled{% endif %}>Create User</button>
    </form>

    <p>
        Already have an account? 
        <a href="{% url 'user_login' %}">Log in here</a>.
    </p>

    <!-- Back Button -->
    <button onclick="window.history.back()">Back</button>

    <script>
        const form = document.querySelector('form');
        const createUserButton = document.getElementById('create-user-button');

        // Function to check if all required fields are valid
        function validateForm() {
            const inputs = form.querySelectorAll('input, select');
            let isValid = true;

            inputs.forEach(input => {
                if (input.required && !input.value.trim()) {
                    isValid = false;
                }
            });

            // Check if both checkboxes are checked
            const consentCheckbox = document.getElementById('id_expression_of_consent');
            const declarationCheckbox = document.getElementById('id_declaration_undertaking');
            if (!consentCheckbox.checked || !declarationCheckbox.checked) {
                isValid = false;
            }

            // Enable or disable the button based on form validity
            createUserButton.disabled = !isValid;
        }

        // Attach event listeners to all form inputs
        form.addEventListener('input', validateForm);
        form.addEventListener('change', validateForm);

        // Initial validation check
        validateForm();
    </script>
</body>
</html>
